<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Vote</title>
    <style>
      /* CSS styles */
      body {
        font-family: Arial, sans-serif;
        background-color: aqua;
      }

      .header {
        background-color: #333;
        color: #fff;
        padding: 20px 0;
        text-align: center;
      }

      .header-title {
        margin: 0;
      }

      .user-pics-container {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }

      .user-pic {
        width: 150px;
        text-align: center;
      }

      .user-pic img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        margin-bottom: 10px;
      }

      .user-name {
        font-size: 14px;
        color: #666;
      }
    </style>
  </head>
  <body>
    <header class="header">
      <h1 class="header-title">Vote for Your Favorite User</h1>
    </header>

    <div class="user-pics-container" id="userPics"></div>

    <!-- Google Sign-In Script -->
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <meta
      name="google-signin-client_id"
      content="999287626395-feroc74e61mdc1pr86evsj391n2vo6it.apps.googleusercontent.com" />

    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-database.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDXSLlef9SYpaP6ZGZvieMEsdn5PvQxhJw",
        authDomain: "direct-tv-b8cbc.firebaseapp.com",
        databaseURL: "https://direct-tv-b8cbc-default-rtdb.firebaseio.com",
        projectId: "direct-tv-b8cbc",
        storageBucket: "direct-tv-b8cbc.appspot.com",
        messagingSenderId: "999287626395",
        appId: "1:999287626395:web:7ded376396f7e2d2aa443e",
      };
      firebase.initializeApp(firebaseConfig);
      const database = firebase.database();

      // Function to fetch and display user data
      function displayUserPics() {
        const userPicsContainer = document.getElementById("userPics");
        userPicsContainer.innerHTML = ""; // Clear previous data

        const usersRef = database.ref("users");
        usersRef.once("value", (snapshot) => {
          const userData = snapshot.val();
          for (let userId in userData) {
            const user = userData[userId];
            const userDiv = document.createElement("div");
            userDiv.classList.add("user-pic");
            userDiv.setAttribute("data-user-id", userId);
            userDiv.setAttribute("data-current-vote", user.userVote || 0);
            userDiv.addEventListener("click", () => addVote(userId));
            const img = document.createElement("img");
            img.src = user.userPic;
            img.alt = "User Image";
            const name = document.createElement("div");
            name.textContent = user.userName; // Add user name
            name.classList.add("user-name"); // Add class for styling
            userDiv.appendChild(img);
            userDiv.appendChild(name); // Append user name below the image
            userPicsContainer.appendChild(userDiv);
          }
        });
      }

      // Function to add a vote for a user
      function addVote(userId) {
        const userDiv = document.querySelector(
          `.user-pic[data-user-id="${userId}"]`
        );
        const currentVote = parseInt(userDiv.getAttribute("data-current-vote"));
        const userRef = database.ref("users/" + userId);
        userRef.update({ userVote: currentVote + 1 });
        userDiv.setAttribute("data-current-vote", currentVote + 1);
      }

      // Function to initialize Google Sign-In
      function initGoogleSignIn() {
        gapi.load("auth2", function () {
          const auth2 = gapi.auth2.init({
            client_id:
              "999287626395-feroc74e61mdc1pr86evsj391n2vo6it.apps.googleusercontent.com",
          });

          // Attach the sign-in listener
          auth2.attachClickHandler("googleSignInButton", {}, onSignIn, onError);
        });
      }

      // Function to handle successful sign-in
      function onSignIn(user) {
        const profile = user.getBasicProfile();
        const userId = profile.getId();
        const userName = profile.getName();
        const userPic = profile.getImageUrl();

        // You can now use the userId, userName, and userPic to manage authentication or display user information.
      }

      // Function to handle sign-in errors
      function onError(error) {
        console.log(error);
      }

      // Call the function to initialize Google Sign-In when the page loads
      window.onload = function () {
        initGoogleSignIn();
        displayUserPics();
      };
    </script>
  </body>
</html>
